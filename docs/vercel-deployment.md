# Vercel Deployment

This guide covers deploying the Laravel application to Vercel.

## Prerequisites

- [Vercel CLI](https://vercel.com/docs/cli) installed (`npm i -g vercel`)
- Vercel account
- External database (e.g., PlanetScale, Neon, Supabase)

## Important Limitations

Vercel runs PHP as serverless functions with these constraints:

- **No persistent file storage** - Use external storage (S3, Cloudinary)
- **No persistent sessions** - Uses cookie-based sessions
- **No background jobs** - Use external queue services
- **Cold starts** - First request may be slower

## Setup

### 1. Configure Environment Variables

In Vercel Dashboard → Project → Settings → Environment Variables, add:

```
APP_NAME=YourAppName
APP_ENV=production
APP_KEY=base64:your-generated-key
APP_DEBUG=false
APP_URL=https://your-project.vercel.app

DB_CONNECTION=mysql
DB_HOST=your-database-host
DB_PORT=3306
DB_DATABASE=your-database
DB_USERNAME=your-username
DB_PASSWORD=your-password

SESSION_DRIVER=cookie
CACHE_DRIVER=array
LOG_CHANNEL=stderr
```

### 2. Generate APP_KEY

If you don't have an APP_KEY:

```bash
php artisan key:generate --show
```

Copy the output and add it to Vercel environment variables.

### 3. Deploy

```bash
# Login to Vercel
vercel login

# Deploy (first time - will prompt for configuration)
vercel

# Production deployment
vercel --prod
```

### 4. Configure Build Settings

In Vercel Dashboard → Project → Settings → Build & Development Settings:

- **Output Directory**: `public`
- **Install Command**: `composer install --no-dev --optimize-autoloader && npm install`
- **Build Command**: `npm run build`

### 5. Run Migrations

After deployment, run migrations using a one-time script or database GUI:

```bash
# Locally with production database credentials
php artisan migrate --force
```

Or use Vercel's one-off function execution if available.

## Troubleshooting

### MissingAppKeyException

Add `APP_KEY` to Vercel environment variables (see step 2).

### 500 Error / Blank Page

1. Set `APP_DEBUG=true` temporarily to see errors
2. Check Vercel Function logs in the dashboard
3. Ensure all required environment variables are set

### Database Connection Issues

- Verify database credentials in environment variables
- Ensure database allows connections from Vercel's IP ranges
- Use SSL connection if required by your database provider

### Assets Not Loading

Verify the routes in `vercel.json` correctly serve static assets from `/public/build/`.

## File Structure

```
├── api/
│   └── index.php          # Entry point for Vercel
├── vercel.json            # Vercel configuration
├── .vercelignore          # Files to exclude from deployment
└── public/
    └── build/             # Compiled assets (generated by npm run build)
```
